---
title: "Farmer Perceptions of Climate and Fertilizer"
author: "Karina Johnston"
date: "12/1/2021"
output: 
  html_document: 
    theme: cerulean
    code_folding: hide
---

```{r setup, include = TRUE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

# Assign packages
library(tidyverse) # graphs and visualizations (ggplot), dplyr, and many functions
library(here) # standardized project pathways
library(kableExtra) # to create professional tables
library(broom) # help summarize statistical models
library(janitor) # to use tabyl() function

```

In this study by Stuart et al. (2012), farmers were surveyed to understand their perception of and responses to climate change. This data is one component of a larger study about barriers to reflexive modernizatino in US agriculture. Results are evaluated using a chi-square analysis. 

```{r}
# Read in the data

farmer <- read_csv(here("data", "farmer_survey.csv"))
```


```{r}
# Wrangle the data

farmer_sub <- farmer %>% # create a subset dataframe
  select(c(response, question_code)) %>% # drop the id column
  filter(question_code %in% 
           c("n2o_greenhouse", "cc_farmers")) # filter for specific question responses
```


```{r}
# create a finalized Table 1

survey_counts <- farmer_sub %>% # creates a new table dataframe
  tabyl(question_code, response, show_na = FALSE)  # counts the data

survey_proportions <- survey_counts %>% # new dataframe table with proportions added
  adorn_percentages() %>%  # note default is to calculate proportions by rows 
  adorn_pct_formatting(digits = 2) %>%  # and update digits
  adorn_ns() %>% # and add sample size
  arrange(desc(question_code)) %>% # switch order of rows to make more sense
  mutate(question_new = case_when( # Add a new column and update values 
    question_code == "n2o_greenhouse" ~ "Is nitrous oxide a GHG?", 
    question_code == "cc_farmers" ~ "Can farmers reduce GHGs?" 
  )
  ) 

col_order <- c("question_new", "yes", "no") # create column order vector

survey_proportions2 <- 
  survey_proportions[, col_order] # new dataframe with columns ordered
```


```{r}
# these functions update the table to be cleaner, easier to read, and visually appealing

kable(survey_proportions2,
      col.names = c("Question", # changes the column names
                    "Yes % (Count)", 
                    "No % (Count)"),
      align = "lcc", # changes the alignment of the columns
    
# adds a caption
      caption = "Table 1. Summary percentages (%) and counts for 
two survey questions given to farmers regarding 
greenhouse gas emissions (GHGs) (Data: Stuart 2021).") %>% 
  kable_styling(full_width = FALSE) # cleaner table output

```


```{r}
# Run a chi-square test

survey_chi_table <- survey_counts %>% # create a new dataframe
  column_to_rownames(var = "question_code") # to format for a chi-square analysis

survey_x2 <- chisq.test(survey_chi_table) # run the new chi-square

survey_x2_tidy <- tidy(survey_x2) # create a tidy table for easy in-line referencing

```

<br>

Survey results found that there was a significant association between farmersâ€™ awareness that nitrous oxide ($N_2O$) is a greenhouse gas (GHG), and their perception of whether farmers can or cannot play an important role in reducing greenhouse gas emissions (`r survey_x2_tidy$method` $\chi$^2^(`r survey_x2_tidy$parameter`) = `r round(survey_x2_tidy$statistic, 2)`, *p* `r ifelse(survey_x2_tidy$p.value < 0.001, paste("< 0.001"), paste("=", survey_x2_tidy$p.value))`). Since the *p* value is less than our significance value set at 0.05, then we can reject the null hypothesis that there is no relationship between the variables studied. Therefore the variables are dependent on each other.

Less than half of the farmer survey respondents answered correctly that $N_2O$ is a greenhouse gas [`r survey_proportions2$yes[1]`], while `r survey_proportions2$no[1]` answered "no". However, the majority of the farmers stated that they did think that they could contribute to greenhouse gas reductions, by responding "yes" to the question about farmers' ability to reduce GHGs [`r survey_proportions2$yes[2]`], while the rest responded "no" [`r survey_proportions2$no[2]`]. 


### Citations

Firke, Sam (2021). janitor: Simple Tools for Examining and Cleaning Dirty Data. R package version 2.1.0. https://CRAN.R-project.org/package=janitor

Robinson, David, Alex Hayes and Simon Couch (2021). broom: Convert Statistical Objects into Tidy Tibbles. R package version 0.7.10. https://CRAN.R-project.org/package=broom

Stuart, D. 2021. Farmer surveys at the Kellogg Biological Station, Hickory Corners, MI (2011) ver 4. Environmental Data Initiative. https://doi.org/10.6073/pasta/55eda6881dcf45977626c58e3f24b82e

Wickham, H. et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686, https://doi.org/10.21105/joss.01686

Zhu, H. (2021). kableExtra: Construct Complex Table with 'kable' and Pipe Syntax. R package version 1.3.4. https://CRAN.R-project.org/package=kableExtra

